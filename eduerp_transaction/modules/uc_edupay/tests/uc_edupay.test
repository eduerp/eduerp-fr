<?php 


/**
* @file
* Simpletest for uc_eduerp_fees module
*/

include_once './'. drupal_get_path('module', 'uc_edupay') . '/tests/test_utils.inc';

/**
* There are four basic steps involved in building a test:
*
* Creating the structure (just creating a class that inherits from DrupalWebTestCase)
* Initializing the test case with whatever user creation or configuration needs to be done
* Creating actual tests within the test case
* And, of course, trying desperately to figure out why our test doesn't work the way we expect, and debugging the test (and perhaps the module)
*/

class UCEdupayTestCase extends DrupalWebTestCase {
  protected $privileged_user;

  /**
   * getInfo() returns properties that are displayed in the test selection form.
   */
  public static function getInfo() {
    return array(
      'name' => 'UCEdupay SimpleTest',
      'description' => 'Ensures that fees are processed successfully by the payment gateway.',
      'group' => 'Eduerp',
    );
  }
  
  /**
   * setUp() performs any pre-requisite tasks that need to happen. 
   */
  public function setUp() {
    // Enable any modules required for the test.
    parent::setUp('uc_edupay, uc_eduerp_fees, uc_cart, staff');

    // Create and log in our privileged user.
    $this->privileged_user = $this->drupalCreateUser( array(
      'administer site configuration')
    );
    $this->drupalLogin($this->privileged_user);
  }
  
  public function testInvoicing() {
    //dsm(views_get_view_result('pdf_invoice', 'pdf_1', 281));
  }
  
  public function testFeesOrderTableExists() {
    $this->assertFalse(uc_edupay_create_table(), FALSE);
  }
  
  /**
   * Test insertion of ordered fees into fees_order
   * table when an order is created.
   * 
   */ 
  public function testFeesOrderSave() {
    $fees = array();
    $fees['nid'] = 5233;
    $fees['type'] = 'fees';
    $fees['cart_item_id'] = 394;
    $fees['title'] = 'School fee item product';
    $fees['price'] = 0;
    $fees['nationality'] = 'Local';
    $fees['programme'] = 'B.Sc Industrial Chemistry';
    $fees['level_name'] = 'Freshman';
    $fees['session'] = '2010/2011';
    $fees['late_registration_date'] = NULL;
    $fees['late_registration_amount'] = '5000';
    $fees['late_registration_nid'] = 5212;
    $fees['late_registration_description'] = 'Late Registration Charges';
    $fees['uid'] = 955;
    $fees['jambno'] = '334446575';
    $fees['fullnames'] = 'Kayode Bakare';
    $fees['institution'] = 2;
    $fees['status'] = 'in_checkout';
    $fees['email'] = 'dreyemi@gmail.com';
    $fees['order_id'] = 302;
    $fees['scholarship'] = 0;
    $fees['allow_instalment'] = 1;
    $fees['hostel_nid'] = 5101;
    $fees['hostel_type'] = 'hostel';
    $fees['expiry_date'] = '2012-11-20 20:30:00';
    $fees['attributes'] = 'B.Sc Industrial Chemistry - Freshman - Local (General fee - Instalment1)';
    $fees['module'] = 'uc_product';
    
    $key = empty($fees->order_id) ? NULL : 'fees_order_id';
    $inserted_data = drupal_write_record('fees_order', $fees, $key);
    
    $this->assertTrue($inserted_data == SAVED_NEW, t('Correct values inserted'));


  }
}
